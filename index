<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>資源扣除計算器 (支援單位 k/m/b/g)</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 2em;
      max-width: 400px;
      margin: auto;
    }
    input, button {
      margin: 0.5em 0;
      padding: 0.5em;
      width: 100%;
      font-size: 1em;
    }
    .result {
      margin-top: 1em;
      font-weight: bold;
      color: green;
    }
  </style>
</head>
<body>
  <h2>資源扣除計算器</h2>

  <label for="after">被扣後的資源數量 (X)：</label>
  <input type="text" id="after" placeholder="例如：800k, 1.5m, 2b, 3g">

  <label for="percent">扣除百分比 (%) (Y)：</label>
  <input type="number" id="percent" placeholder="例如：20">

  <button onclick="calculate()">計算原始資源數量</button>

  <div class="result" id="result"></div>

  <script>
    function parseResource(input) {
      input = input.trim().toLowerCase();
      const match = input.match(/^([\d.]+)\s*([kmbg]?)$/);
      if (!match) return NaN;

      const num = parseFloat(match[1]);
      const unit = match[2];

      if (isNaN(num)) return NaN;

      switch (unit) {
        case 'k': return num * 1_000;
        case 'm': return num * 1_000_000;
        case 'b':
        case 'g': return num * 1_000_000_000;
        default: return num;
      }
    }

    function formatWithUnit(value) {
      if (value >= 1_000_000_000) return (value / 1_000_000_000).toFixed(2) + 'b';
      if (value >= 1_000_000) return (value / 1_000_000).toFixed(2) + 'm';
      if (value >= 1_000) return (value / 1_000).toFixed(2) + 'k';
      return value.toFixed(2);
    }

    function calculate() {
      const raw = document.getElementById('after').value;
      const percent = parseFloat(document.getElementById('percent').value);
      const x = parseResource(raw);

      if (isNaN(x) || isNaN(percent) || percent >= 100 || percent < 0) {
        document.getElementById('result').textContent = "請輸入正確的資源數量與扣除百分比（% < 100）";
        return;
      }

      const original = x / (1 - percent / 100);
      document.getElementById('result').textContent = `扣除前的資源數量為：約 ${formatWithUnit(original)}`;
    }
  </script>
</body>
</html>
